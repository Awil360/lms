pipeline {
    agent any

    environment {
        DOCKER_REGISTRY = 'awil360'
        FRONTEND_IMAGE = "${DOCKER_REGISTRY}/lms-front"
        BACKEND_IMAGE = "${DOCKER_REGISTRY}/lms-backend"
        DOCKER_CREDENTIALS_ID = 'lms-docker'
        POSTGRES_CONTAINER_NAME = 'lms-database'
        POSTGRES_PASSWORD = 'awil123456'
        POSTGRES_IMAGE = 'postgres'
    }
        
    stages {
        stage('Start PostgreSQL Container') {
            steps {
                script {
                    // /Run PostgreSQL container
                    sh """
                        docker run -dt --name ${env.POSTGRES_CONTAINER_NAME} \
                        -e POSTGRES_PASSWORD=${env.POSTGRES_PASSWORD} \
                        ${env.POSTGRES_IMAGE}
                    """

                    // Get the IP address of the PostgreSQL container
                    def dbIp = sh(script: "docker inspect -f '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' ${env.POSTGRES_CONTAINER_NAME}", returnStdout: true).trim()
                    // Set the DATABASE_URL environment variable
                    env.DATABASE_URL = "postgresql://postgres:${env.POSTGRES_PASSWORD}@${dbIp}:5432/postgres"
                }
            }
        }

        
    }
}
